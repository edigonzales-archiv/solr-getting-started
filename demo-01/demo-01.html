<!DOCTYPE html>
<html>
   <head>
      <title>Adresssuche</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.min.js"></script>  
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
   </head>
   <body>
      <br /><br />
      <div class="container" style="width:600px;">
         <h2 align="center">Adresssuche</h2>
         <br /><br />
         <label>Search Address</label>
         <input type="text" name="address" id="address" class="form-control input-lg" autocomplete="off" placeholder="Type Address" />
      </div>
   </body>
</html>
<script>
$(document).ready(function() {

$('#address').typeahead({
    source: function(query, response) {
        console.log("*************************************");
        console.log(query);

        var searchTerms = query.toLowerCase().trim().replace(",","").replace("."," ").replace("-"," ").split(" ");
        console.log(searchTerms);

        var i;
        var solrQueryText = "";
        for (i = 0; i < searchTerms.length; i++) { 
            console.log("for: i="+i);

            if (i > 0) {
                console.log("append AND");
                solrQueryText += "+AND+"
            }
            
            if (searchTerms[i] == "") {
                console.log("continue");
                continue;
            }
            
            solrQueryText += "full_address:" + searchTerms[i] + "*";
            //console.log("searchTerms[i]")
            //console.log(searchTerms[i])
            //console.log(i)
            //console.log(searchTerms.length)


/*
            if (searchTerms[i] != "") {
                if (i < searchTerms.length - 1) {
                    solrQueryText += "+AND+"
                }
            }
*/
        }
        //console.log(solrQueryText);

        $.ajax({
            url: "http://localhost:8983/solr/address/select",
            crossDomain: true,
            method: "GET",
            //data: "q="+solrQueryText+"&start=0&rows=20&sort=ortschaft+asc,strassenname+asc,hausnummer_prefix+asc,hausnummer_appendix+asc",
            //processData: false,
            data: {
                q : "full_address:gass*"
            },
            dataType: 'jsonp',
            jsonp: 'json.wrf',
            success: function(data) {
                //console.log(data);
                //console.log(data.response.docs);
                response(data.response.docs);
            }
        })
    },
    displayText: function(item) {
        //console.log(item);
        return item.full_address;
        //return "Obere Gasse";
    },
    highlighter: function (item) {
        //console.log("Haaaalloooo******* HIGHLIGHTER");
        //console.log(item);
            //return item;
            return item.display_address;
        },
        
    items: 20,
    fitToElement: true,
    autoSelect: false,
    minLength: 2
});

$("#address").data("typeahead").render = function (items) {
    console.log("render");
    console.log(items);
    var that = this;

  
    items = $(items).map(function (i, item) {
        console.log(item);
        var itemClass = (item == "Sunday" || item == "Saturday") ? "weekend" : "weekday";
        i = $(that.options.item).attr('data-value', item).attr("class", itemClass);
        i.find('a').html(that.highlighter(item))
        return i[0]
    })
    items.first().addClass('active')
    this.$menu.html(items)
  
  return this
};

});
</script>

